<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
	<h1>공연목록</h1>
    <hr>
    <div></div>
    <div></div>
<script>
    /* Javascript 샘플 코드 */

window.onload = function() {
    var xhr = new XMLHttpRequest();
    var url = 'https://cors-anywhere.herokuapp.com/http://www.culture.go.kr/openapi/rest/publicperformancedisplays/period'; /*URL*/
    var queryParams = '?' + encodeURIComponent('serviceKey') + '='+'uPhfT4W7%2BfRGxSa2CbEY27K4LycechVswTVTlHGsnfqyAC8aPMNz1dlmaY8082lJaj18zzPOyR%2B9lK4u1QSwEg%3D%3D'; /*Service Key*/
    /*
    // Test Link: http://127.0.0.1:8000/index/apitest/
    // TODO: 이거 지우면 데이터받아와짐, but why?
    queryParams += '&' + encodeURIComponent('keyword') + '=' + encodeURIComponent('');
    queryParams += '&' + encodeURIComponent('sortStdr') + '=' + encodeURIComponent('1');
    queryParams += '&' + encodeURIComponent('ComMsgHeader') + '=' + encodeURIComponent('');
    queryParams += '&' + encodeURIComponent('RequestTime') + '=' + encodeURIComponent('20100810:23003422');
    queryParams += '&' + encodeURIComponent('CallBackURI') + '=' + encodeURIComponent('');
    queryParams += '&' + encodeURIComponent('MsgBody') + '=' + encodeURIComponent('');
    queryParams += '&' + encodeURIComponent('from') + '=' + encodeURIComponent('20100101');
    queryParams += '&' + encodeURIComponent('to') + '=' + encodeURIComponent('20221201');
    queryParams += '&' + encodeURIComponent('cPage') + '=' + encodeURIComponent('1');
    queryParams += '&' + encodeURIComponent('rows') + '=' + encodeURIComponent('10');
    queryParams += '&' + encodeURIComponent('place') + '=' + encodeURIComponent('1');
    queryParams += '&' + encodeURIComponent('gpsxfrom') + '=' + encodeURIComponent('129.101');
    queryParams += '&' + encodeURIComponent('gpsyfrom') + '=' + encodeURIComponent('35.142');
    queryParams += '&' + encodeURIComponent('gpsxto') + '=' + encodeURIComponent('129.101');
    queryParams += '&' + encodeURIComponent('gpsyto') + '=' + encodeURIComponent('35.142');
    */

    /*
    xhr.onreadystatechange = function () {
        if (this.readyState == 4) {
            alert('Status: '+this.status+'nHeaders: '+JSON.stringify(this.getAllResponseHeaders())+'nBody: '+this.responseText);
        }
    };
    */
    xhr.open('GET', url + queryParams, true);
    xhr.onload = function(){
    //document.getElementsByTagName('div')[0].textContent = xhr.responseText;
    //document.getElementsByTagName('div')[0].textContent = (xhr.response).getElementsByTagName('title');

    // xml String -> xml
    let parser, xmlDoc;
    parser = new DOMParser();
    xmlDoc = parser.parseFromString(xhr.responseText, "text/html"); // String -> xml 만들어주는 과정

    // Test
    var test1 = xmlDoc.getElementsByTagName('perforlist')[0];
    var test2 = test1.getElementsByTagName('thumbnail')[0];
    var test3 = test1.getElementsByTagName('thumbnail')[0].childNodes[0];
    var test4 = test1.getElementsByTagName('thumbnail')[0].childNodes[0].nodeValue;
    console.log(xmlDoc);
    console.log(test1);
    console.log('---------test3----------');
    console.log(test3);
    console.log(typeof(test3));
    console.log('---------test4----------');
    console.log(test4);
    console.log(typeof(test4));
    console.log(String(test4));

    // 이미지 출력
    var img = document.createElement("img");
    img.src = test4;
    var src = document.getElementsByTagName('div')[1];
    src.appendChild(img);

    console.log(xmlDoc.getElementsByTagName('rows')[0])
    console.log(xmlDoc.getElementsByTagName('rows')[0].nodeValue)
    document.getElementsByTagName('div')[0].textContent = test4;

    //
    //console.log(JSON.parse(xhr.responseText).boxOfficeResult.dailyBoxOfficeList[0].movieNm)
    };
    xhr.send('');
};
</script>
</body>
</html>







